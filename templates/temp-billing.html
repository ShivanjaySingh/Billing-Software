<!DOCTYPE html>
<html>
<head>
    <title>Billing Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

</head>
<body>
    <div class="container my-5">
        <div class="card shadow-lg border-0 rounded-4">
          <div class="card-header bg-primary text-white rounded-top-4">
            <h4 class="mb-0"><i class="bi bi-receipt"></i> Create Invoice</h4>
          </div>
          <div class="card-body p-4">
            <form method="POST" id="invoiceForm">
      
              <!-- Customer Section -->
              <div class="row mb-4">
                <div class="col-md-6">
                  <label class="form-label fw-semibold">Select Customer</label>
                  <select name="customer_id" class="form-select shadow-sm" required>
                    <option value="">-- Select Customer --</option>
                    {% for c in customers %}
                      <option value="{{c.id}}">{{c.name}} ({{c.phone}})</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label fw-semibold">Place of Supply</label>
                  <input type="text" name="place_of_supply" class="form-control shadow-sm" placeholder="Enter state code (e.g. 09)" required>
                </div>
              </div>
      
              <!-- Products Table -->
              <h5 class="mb-3 text-secondary"><i class="bi bi-cart-check"></i> Products</h5>
              <div class="table-responsive">
                <table id="productTable" class="table table-bordered align-middle text-center">
                  <thead class="table-light">
                    <tr>
                      <th style="width: 35%;">Product</th>
                      <th style="width: 15%;">Qty</th>
                      <th style="width: 20%;">Price (₹)</th>
                      <th style="width: 20%;">Total (₹)</th>
                      <th style="width: 10%;">Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>
                        <select name="product_id[]" class="form-select shadow-sm" required>
                          <option value="">-- Select Product --</option>
                          {% for p in products %}
                            <option value="{{p.id}}">{{p.name}}</option>
                          {% endfor %}
                        </select>
                      </td>
                      <td><input type="number" name="qty[]" class="form-control text-center shadow-sm qty" step="1" value="1" required></td>
                      <td><input type="number" name="price[]" class="form-control text-center shadow-sm price" step="0.01" placeholder="0.00" required></td>
                      <td><input type="text" class="form-control text-center shadow-sm line-total" value="0.00" readonly></td>
                      <td>
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeRow(this)">
                          <i class="bi bi-trash"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
      
              <!-- Add Product Button -->
              <div class="d-flex justify-content-start mb-4">
                <button type="button" class="btn btn-outline-primary" onclick="addRow()">
                  <i class="bi bi-plus-circle"></i> Add Product
                </button>
              </div>
      
              <!-- Grand Total -->
              <div class="row">
                <div class="col-md-6"></div>
                <div class="col-md-6 text-end">
                  <h4 class="fw-bold">Grand Total: ₹ <span id="grandTotal">0.00</span></h4>
                </div>
              </div>
      
              <!-- Submit -->
              <div class="text-end mt-4">
                <button type="submit" class="btn btn-success btn-lg px-4 shadow">
                  <i class="bi bi-check-circle"></i> Create Invoice
                </button>
              </div>
      
            </form>
          </div>
        </div>
      </div>
      
      <script>
      function addRow() {
        let table = document.getElementById("productTable").getElementsByTagName("tbody")[0];
        let newRow = table.rows[0].cloneNode(true);
      
        newRow.querySelectorAll("input").forEach(inp => {
          if (inp.classList.contains("line-total")) {
            inp.value = "0.00";
          } else {
            inp.value = "";
          }
        });
        newRow.querySelector("select").selectedIndex = 0;
        table.appendChild(newRow);
      }
      
      function removeRow(btn) {
        let row = btn.closest("tr");
        let table = document.getElementById("productTable").getElementsByTagName("tbody")[0];
        if (table.rows.length > 1) row.remove();
        updateTotals();
      }
      
      function updateTotals() {
        let rows = document.querySelectorAll("#productTable tbody tr");
        let grandTotal = 0;
        
        rows.forEach(row => {
          let qty = parseFloat(row.querySelector(".qty").value) || 0;
          let price = parseFloat(row.querySelector(".price").value) || 0;
          let total = qty * price;
          row.querySelector(".line-total").value = total.toFixed(2);
          grandTotal += total;
        });
      
        document.getElementById("grandTotal").innerText = grandTotal.toFixed(2);
      }
      
      document.addEventListener("input", function(e) {
        if (e.target.classList.contains("qty") || e.target.classList.contains("price")) {
          updateTotals();
        }
      });
      </script>
</body>
</html>
